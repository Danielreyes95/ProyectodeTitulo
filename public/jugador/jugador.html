<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Jugador</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<!-- üîê Validaci√≥n -->
<script>
if (!localStorage.getItem("token") || localStorage.getItem("rol") !== "apoderado") {
    window.location.href = "../index.html";
}
</script>

<!-- ‚≠ê IMPORTANTE PARA PRODUCCI√ìN -->
<script src="../js/config.js"></script>

<main class="p-10 min-h-screen relative flex flex-col">

    <!-- T√çTULO -->
    <h1 class="text-3xl font-bold text-blue-700">Bienvenido</h1>
    <p class="text-gray-600 mb-10">Panel del jugador</p>

    <!-- INFORMACI√ìN DEL JUGADOR -->
    <div class="bg-white shadow-lg rounded-xl p-6 mb-10 border-l-8 border-blue-600">
        <h2 class="text-xl font-bold text-blue-700 mb-3">Informaci√≥n del Jugador</h2>

        <p class="text-lg"><b>Nombre:</b> <span id="nombreJugador"></span></p>
        <p class="text-lg"><b>RUT:</b> <span id="rutJugador"></span></p>
        <p class="text-lg"><b>Categor√≠a:</b> <span id="categoriaJugador"></span></p>
    </div>

    <!-- ACCESOS R√ÅPIDOS -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 z-10">

        <a href="./eventos-jugador.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-blue-600
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-blue-700">Eventos</p>
            <p class="text-gray-500 text-sm">Ver eventos y confirmar asistencia</p>
        </a>

        <a href="./mi-categoria.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-purple-500
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-purple-700">Mi Categor√≠a</p>
            <p class="text-gray-500 text-sm">Ver profesor y compa√±eros de equipo</p>
        </a>

        <a href="./rendimiento-jugador.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-green-600
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-green-700">Rendimiento</p>
            <p class="text-gray-500 text-sm">Rendimiento de la categor√≠a</p>
        </a>

        <a href="./pagos-jugador.html"
            class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-amber-500
                    hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-amber-700">Pagos</p>
            <p class="text-gray-500 text-sm">Pagar mensualidad y ver historial</p>
        </a>
    </div>

    <!-- PR√ìXIMO EVENTO -->
    <div class="bg-white shadow-md rounded-xl p-6 mt-10 mb-10 border-l-8 border-amber-500">
        <h2 class="text-xl font-bold text-amber-700 mb-4">Pr√≥ximo Evento</h2>

        <div id="proximoEvento" class="text-gray-600">
            Cargando informaci√≥n...
        </div>
    </div>

    <!-- BOT√ìN LOGOUT -->
    <div class="mt-auto mb-10 z-10">
        <button onclick="logout()"
                class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded shadow">
            Cerrar sesi√≥n
        </button>
    </div>

    <!-- MARCA DE AGUA -->
    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-0 pointer-events-none">
        <h2 class="text-6xl md:text-7xl font-extrabold text-blue-600 opacity-10 select-none">
            Escuela de F√∫tbol
        </h2>
    </div>

</main>

<script>
// CERRAR SESI√ìN
function logout() {
    localStorage.clear();
    window.location.href = "../index.html";
}

// CARGAR INFO DEL JUGADOR
document.getElementById("nombreJugador").innerText = localStorage.getItem("nombreJugador");
document.getElementById("rutJugador").innerText = localStorage.getItem("rutJugador");
document.getElementById("categoriaJugador").innerText = localStorage.getItem("categoriaNombreJugador");

// ‚úÖ CARGAR PR√ìXIMO EVENTO
async function cargarProximoEvento() {
    const cont = document.getElementById("proximoEvento");

    // üëá usar el ID real de la categor√≠a, no el nombre
    const catId = localStorage.getItem("categoriaIdJugador");

    if (!catId) {
        cont.innerHTML = "<p>No se encontr√≥ la categor√≠a del jugador.</p>";
        console.warn("No hay categoriaIdJugador en localStorage");
        return;
    }

    try {
        // Si tu ruta es /api/evento/categoria deja 'evento', si es /api/eventos/categoria cambia ac√°
        const res = await fetch(`${BASE_URL}/api/evento/categoria/${catId}`);
        const eventos = await res.json();

        console.log("Eventos recibidos para Pr√≥ximo Evento:", eventos);

        if (!Array.isArray(eventos) || eventos.length === 0) {
            cont.innerHTML = "<p>No hay eventos programados.</p>";
            return;
        }

        const hoy = new Date();
        const hoySinHora = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate());

        // üëá usar fechaEvento y tipoEvento del schema
        const futuros = eventos
            .filter(e => e.fechaEvento && new Date(e.fechaEvento) >= hoySinHora)
            .sort((a, b) => new Date(a.fechaEvento) - new Date(b.fechaEvento));

        if (futuros.length === 0) {
            cont.innerHTML = "<p>No hay eventos futuros.</p>";
            return;
        }

        const ev = futuros[0];
        const fecha = new Date(ev.fechaEvento).toLocaleDateString("es-CL", {
            weekday: "long",
            day: "2-digit",
            month: "long"
        });

        cont.innerHTML = `
            <p><b>Fecha:</b> ${fecha}</p>
            <p><b>Tipo:</b> ${ev.tipoEvento || "-"}</p>
            ${ev.lugar ? `<p><b>Lugar:</b> ${ev.lugar}</p>` : ""}
            <button onclick="verEvento('${ev._id}')" 
                class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                Ver evento
            </button>`;
    } catch (error) {
        console.error("Error cargando pr√≥ximo evento:", error);
        cont.innerHTML = "<p>Error al cargar los eventos.</p>";
    }
}

function verEvento(id) {
    localStorage.setItem("eventoSeleccionado", id);
    window.location.href = "./eventos-jugador.html";
}

cargarProximoEvento();
</script>

</body>
</html>
