<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Jugador</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Estilos globales -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
</head>

<body class="bg-gray-100">

<!-- VALIDACIÓN -->
<script>
if (!localStorage.getItem("token") || localStorage.getItem("rol") !== "apoderado") {
    window.location.href = "../index.html";
}
</script>

<script src="../js/config.js"></script>

<!-- ===========================
     CONTENIDO PRINCIPAL
=========================== -->
<main class="p-6 min-h-screen relative flex flex-col">

    <!-- TÍTULO -->
    <h1 class="text-3xl font-bold text-blue-700">Bienvenido</h1>
    <p class="text-gray-600 mb-10">Panel del jugador</p>

    <!-- INFORMACIÓN DEL JUGADOR -->
    <div class="bg-white shadow-lg rounded-xl p-6 mb-10 border-l-8 border-blue-600">
        <h2 class="text-xl font-bold text-blue-700 mb-3">Información del Jugador</h2>

        <p class="text-lg"><b>Nombre:</b> <span id="nombreJugador"></span></p>
        <p class="text-lg"><b>RUT:</b> <span id="rutJugador"></span></p>
        <p class="text-lg"><b>Categoría:</b> <span id="categoriaJugador"></span></p>
    </div>

    <!-- ACCESOS RÁPIDOS -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 z-10">

        <a href="./eventos-jugador.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-blue-600
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-blue-700">Eventos</p>
            <p class="text-gray-500 text-sm">Ver eventos y confirmar asistencia</p>
        </a>

        <a href="./rendimiento-jugador.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-green-600
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-green-700">Rendimiento</p>
            <p class="text-gray-500 text-sm">Estadísticas del jugador</p>
        </a>

        <a href="./pagos-jugador.html"
           class="bg-white shadow-md rounded-xl p-6 text-center border-l-8 border-amber-500
                  hover:shadow-lg hover:scale-[1.02] transition cursor-pointer">
            <p class="text-xl font-bold text-amber-700">Pagos</p>
            <p class="text-gray-500 text-sm">Mensualidad e historial</p>
        </a>
    </div>

    <!-- PRÓXIMO EVENTO -->
    <div class="bg-white shadow-md rounded-xl p-6 mt-10 mb-10 border-l-8 border-indigo-500">
        <h2 class="text-xl font-bold text-indigo-700 mb-4">Próximo Evento</h2>
        <div id="proximoEvento" class="text-gray-600">Cargando información...</div>
    </div>

    <!-- BOTÓN LOGOUT -->
    <div class="mt-auto mb-10 z-10">
        <button onclick="logout()"
                class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded shadow">
            Cerrar sesión
        </button>
    </div>

    <!-- MARCA DE AGUA -->
    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-0 pointer-events-none">
        <h2 class="text-6xl md:text-7xl font-extrabold text-blue-600 opacity-10 select-none">
            Escuela de Fútbol
        </h2>
    </div>

</main>

<!-- ===========================
     SCRIPTS
=========================== -->
<script>
// LOGOUT
function logout() {
    localStorage.clear();
    window.location.href = "../index.html";
}

// INFORMACIÓN DEL JUGADOR
document.getElementById("nombreJugador").innerText = localStorage.getItem("nombreJugador");
document.getElementById("rutJugador").innerText = localStorage.getItem("rutJugador");
document.getElementById("categoriaJugador").innerText = localStorage.getItem("categoriaNombreJugador");

/* ============================================================
   CARGAR PRÓXIMO EVENTO
=========================================================== */
async function cargarProximoEvento() {
    const catId = localStorage.getItem("categoriaJugador");

    const res = await fetch(`${BASE_URL}/api/evento/categoria/${catId}`);
    const eventos = await res.json();

    const cont = document.getElementById("proximoEvento");

    if (!Array.isArray(eventos) || eventos.length === 0) {
        cont.innerHTML = "<p>No hay eventos programados.</p>";
        return;
    }

    const hoy = new Date();
    const hoySinHora = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate());

    const futuros = eventos
        .filter(e => new Date(e.fechaEvento) >= hoySinHora)
        .sort((a, b) => new Date(a.fechaEvento) - new Date(b.fechaEvento));

    if (futuros.length === 0) {
        cont.innerHTML = "<p>No hay eventos futuros.</p>";
        return;
    }

    const ev = futuros[0];
    const fecha = new Date(ev.fechaEvento).toLocaleDateString("es-CL");

    cont.innerHTML = `
        <p><b>Fecha:</b> ${fecha}</p>
        <p><b>Tipo:</b> ${ev.tipoEvento}</p>

        <button onclick="verEvento('${ev._id}')"
            class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded shadow">
            Ver evento
        </button>
    `;
}

function verEvento(id) {
    localStorage.setItem("eventoSeleccionado", id);
    window.location.href = "./ver-evento-jugador.html";
}

cargarProximoEvento();
</script>

</body>
</html>
