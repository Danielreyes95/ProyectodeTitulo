<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Avisos - Director</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Estilos globales -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
</head>

<body>

<!-- =====================================
        VALIDACIÓN
====================================== -->
<script>
if (!localStorage.getItem("token") || localStorage.getItem("rol") !== "director") {
    window.location.href = "../index.html";
}
</script>

<script src="../js/config.js"></script>
<script src="../js/loadSidebar.js"></script>

<!-- =====================================
        SIDEBAR DINÁMICO
====================================== -->
<div id="sidebar-container"></div>

<!-- BOTÓN MENÚ MÓVIL -->
<button id="btnMenu"
    class="md:hidden fixed top-4 left-4 bg-green-700 text-white p-2 rounded shadow z-50">
    ☰
</button>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const btnMenu = document.getElementById("btnMenu");

    btnMenu.addEventListener("click", () => {
        const sidebar = document.getElementById("sidebar");
        if (sidebar) sidebar.classList.toggle("active");
    });
});
</script>

<!-- =====================================
        CONTENIDO PRINCIPAL
====================================== -->
<main class="p-8">

    <!-- HEADER -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4 md:gap-0">
        <h1 class="text-3xl font-bold text-green-700">Gestión de Avisos</h1>

        <button onclick="abrirModalAviso()"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
            + Nuevo aviso
        </button>
    </div>

    <!-- =============================
         FILTROS
    ============================== -->
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">

        <div>
            <label class="font-semibold">Tipo</label>
            <select id="filtroTipo" class="w-full border p-2 rounded">
                <option value="">Todos</option>
                <option value="Torneo">Torneo</option>
                <option value="Entrenamiento">Entrenamiento</option>
                <option value="General">General</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Estado</label>
            <select id="filtroEstado" class="w-full border p-2 rounded">
                <option value="">Todos</option>
                <option value="Vigente">Vigente</option>
                <option value="Archivado">Archivado</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Destinatario</label>
            <select id="filtroDestinatario" class="w-full border p-2 rounded">
                <option value="">Todos</option>
                <option value="Apoderados">Apoderados</option>
                <option value="Entrenadores">Entrenadores</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Categoría</label>
            <select id="filtroCategoria" class="w-full border p-2 rounded">
                <option value="">Todas</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Buscar</label>
            <input id="filtroBuscar" type="text" class="w-full border p-2 rounded"
                   placeholder="Título o contenido..." />
        </div>
    </div>

    <!-- =============================
         TABLA AVISOS
    ============================== -->
    <div class="bg-white p-4 rounded shadow overflow-x-auto">
        <table class="w-full table-auto min-w-[700px]">
            <thead>
                <tr class="border-b bg-gray-200">
                    <th class="p-2 text-left">Título</th>
                    <th class="p-2 text-left">Tipo</th>
                    <th class="p-2 text-left">Destinatario</th>
                    <th class="p-2 text-left">Fecha evento</th>
                    <th class="p-2 text-left">Estado</th>
                    <th class="p-2 text-left">Acciones</th>
                </tr>
            </thead>
            <tbody id="tbodyAvisos"></tbody>
        </table>

        <p id="mensajeSinAvisos" class="text-center text-gray-500 mt-4 hidden">
            No hay avisos registrados con los filtros actuales.
        </p>
    </div>

</main>

<!-- =============================
     MODAL CREAR / EDITAR AVISO
============================== -->
<div id="modalAviso"
    class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center z-50 p-4">

    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-lg">

        <h2 id="tituloModalAviso" class="text-xl font-bold text-green-700 mb-4">
            Nuevo aviso
        </h2>

        <input type="hidden" id="avisoId" />

        <!-- FORMULARIO -->
        <div class="grid grid-cols-1 gap-3">

            <div>
                <label class="font-semibold">Título</label>
                <input id="avisoTitulo" type="text" class="border p-2 rounded w-full">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                    <label class="font-semibold">Tipo</label>
                    <select id="avisoTipo" class="border p-2 rounded w-full">
                        <option value="General">General</option>
                        <option value="Torneo">Torneo</option>
                        <option value="Entrenamiento">Entrenamiento</option>
                    </select>
                </div>

                <div>
                    <label class="font-semibold">Destinatario</label>
                    <select id="avisoDestinatario" class="border p-2 rounded w-full"
                            onchange="mostrarSeleccionEspecifica()">
                        <option value="Todos">Todos</option>
                        <option value="Apoderados">Apoderados</option>
                        <option value="Entrenadores">Entrenadores</option>
                        <option value="EntrenadorEspecifico">Entrenador específico</option>
                        <option value="ApoderadoEspecifico">Jugador específico</option>
                    </select>
                </div>
            </div>

            <!-- ENTRENADOR ESPECÍFICO -->
            <div id="bloqueEntrenador" class="hidden">
                <label class="font-semibold">Seleccionar entrenador</label>
                <select id="avisoEntrenadorId" class="border p-2 rounded w-full"></select>
            </div>

            <!-- JUGADOR ESPECÍFICO -->
            <div id="bloqueJugador" class="hidden">
                <label class="font-semibold">Seleccionar jugador</label>
                <select id="avisoJugadorId" class="border p-2 rounded w-full"></select>
            </div>

            <div>
                <label class="font-semibold">Categoría destinataria</label>
                <select id="avisoCategoria" class="border p-2 rounded w-full">
                    <option value="">Ninguna</option>
                    <option value="todas">Todas</option>
                </select>
            </div>

            <div>
                <label class="font-semibold">Fecha evento (opcional)</label>
                <input type="date" id="avisoFechaEvento" class="border p-2 rounded w-full">
            </div>

            <div>
                <label class="font-semibold">Contenido</label>
                <textarea id="avisoContenido" rows="4" class="border p-2 rounded w-full"></textarea>
            </div>

            <div>
                <label class="font-semibold">Estado</label>
                <select id="avisoEstado" class="border p-2 rounded w-full">
                    <option value="Vigente">Vigente</option>
                    <option value="Archivado">Archivado</option>
                </select>
            </div>
        </div>

        <!-- BOTONES -->
        <div class="flex justify-end gap-2 mt-4">
            <button onclick="cerrarModalAviso()"
                    class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
                Cancelar
            </button>

            <button onclick="guardarAviso()"
                    class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                Guardar
            </button>
        </div>

    </div>
</div>

<!-- SOCKET.IO -->
<script src="/socket.io/socket.io.js"></script>

<script>
const socket = io({
    auth: {
        userId: localStorage.getItem("userId"),
        rol: localStorage.getItem("rol")
    }
});
</script>

<!-- JS PRINCIPAL -->
<script src="/js/avisos.js"></script>

</body>
</html>
