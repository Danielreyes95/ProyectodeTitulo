<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Pagos - Director</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Estilos globales -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
</head>

<body class="bg-gray-100">

<!-- ============================
     MENÚ MÓVIL
============================ -->
<button id="btnMenu"
    class="md:hidden fixed top-4 left-4 bg-green-700 text-white p-2 rounded shadow z-50">
    ☰
</button>

<!-- ============================
     SIDEBAR DINÁMICO
============================ -->
<div id="sidebar-container"></div>
<script src="../js/loadSidebar.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btnMenu");
    btn.addEventListener("click", () => {
        const sidebar = document.querySelector("#sidebar");
        if (sidebar) sidebar.classList.toggle("active");
    });
});
</script>


<!-- ============================
     CONTENIDO
============================ -->
<main class="flex-1 p-6 md:p-10 md:ml-60">

    <h1 class="text-3xl font-bold mb-6 text-green-700">Gestión de Pagos</h1>

    <!-- FILTROS -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">

        <div>
            <label class="font-semibold">Categoría</label>
            <select id="filtroCategoria" class="input">
                <option value="">Todas</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Mes</label>
            <input type="month" id="filtroMes" class="input" />
        </div>

        <div>
            <label class="font-semibold">Estado</label>
            <select id="filtroEstado" class="input">
                <option value="">Todos</option>
                <option value="pagado">Pagado</option>
                <option value="pendiente">Pendiente</option>
                <option value="atrasado">Atrasado</option>
            </select>
        </div>

        <div>
            <label class="font-semibold">Buscar</label>
            <input id="filtroBuscar" type="text" class="input" placeholder="Nombre o RUT..." />
        </div>
    </div>

    <!-- RESUMEN -->
    <div id="bloqueResumen" class="hidden grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">

        <div class="box-resumen bg-green-100">
            <p class="font-bold">Pagados</p>
            <p id="resPagados" class="text-2xl font-bold">0</p>
        </div>

        <div class="box-resumen bg-yellow-100">
            <p class="font-bold">Pendientes</p>
            <p id="resPendientes" class="text-2xl font-bold">0</p>
        </div>

        <div class="box-resumen bg-red-100">
            <p class="font-bold">Atrasados</p>
            <p id="resAtrasados" class="text-2xl font-bold">0</p>
        </div>

        <div class="box-resumen bg-blue-100">
            <p class="font-bold">Monto total</p>
            <p id="resMonto" class="text-2xl font-bold">$0</p>
        </div>

    </div>

    <!-- TABLA -->
    <div class="bg-white p-4 rounded shadow overflow-x-auto">
        <table class="w-full min-w-[800px] table-auto">
            <thead>
                <tr class="border-b bg-gray-200">
                    <th class="p-2">Jugador</th>
                    <th class="p-2">RUT</th>
                    <th class="p-2">Inscripción</th>
                    <th class="p-2">Estado</th>
                    <th class="p-2">Monto</th>
                    <th class="p-2">Acciones</th>
                </tr>
            </thead>
            <tbody id="tbodyPagos"></tbody>
        </table>
    </div>

</main>


<!-- =============================
     MODAL REGISTRAR PAGO
============================== -->
<div id="modalPago" class="modal-overlay hidden">
    <div class="modal-box w-96">

        <h2 class="text-xl font-bold text-green-700 mb-4">Registrar Pago</h2>

        <input type="hidden" id="pagoJugadorId" />
        <input type="hidden" id="pagoMes" />

        <p><b>Jugador:</b> <span id="pagoJugadorNombre"></span></p>
        <p class="mb-3"><b>Mes:</b> <span id="pagoMesTexto"></span></p>

        <label class="font-semibold">Monto</label>
        <input id="pagoMonto" class="input" placeholder="Ej: 25000" oninput="formatearMonto(this)" />

        <label class="font-semibold">Método</label>
        <select id="pagoMetodo" class="input">
            <option value="">Seleccione…</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
        </select>

        <label class="font-semibold">Observación</label>
        <textarea id="pagoObservacion" class="input" rows="2"></textarea>

        <div class="flex justify-end gap-2 mt-4">
            <button onclick="cerrarModalPago()" class="btn bg-gray-300">Cancelar</button>
            <button onclick="confirmarPago()" class="btn btn-primary">Confirmar</button>
        </div>

    </div>
</div>


<!-- =============================
     MODAL EDITAR PAGO
============================== -->
<div id="modalEditar" class="modal-overlay hidden">
    <div class="modal-box w-96">

        <h2 class="text-xl font-bold text-yellow-700 mb-4">Editar Pago</h2>

        <input type="hidden" id="editarPagoId">

        <p><b>Jugador:</b> <span id="editarJugadorNombre"></span></p>
        <p class="mb-3"><b>Mes:</b> <span id="editarMesTexto"></span></p>

        <label class="font-semibold">Método</label>
        <select id="editarMetodo" class="input">
            <option value="">(Sin cambio)</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
            <option value="Tarjeta">Tarjeta</option>
        </select>

        <label class="font-semibold">Monto</label>
        <input id="editarMonto" class="input" placeholder="(Sin cambio)">

        <label class="font-semibold">Observación</label>
        <textarea id="editarObservacion" class="input" rows="2"></textarea>

        <div class="flex justify-end gap-2 mt-4">
            <button onclick="cerrarModalEditar()" class="btn bg-gray-300">Cancelar</button>
            <button onclick="confirmarEdicionPago()" class="btn bg-yellow-600 text-white">Guardar</button>
        </div>

    </div>
</div>


<!-- =============================
     MODAL HISTORIAL
============================== -->
<div id="modalHistorial" class="modal-overlay hidden">
    <div class="modal-box w-[500px]">

        <h2 class="text-xl font-bold text-blue-700 mb-4">Historial de Pagos</h2>

        <p><b>Jugador:</b> <span id="histJugadorNombre"></span></p>

        <label class="font-semibold mt-3">Año</label>
        <select id="selectAnio" class="input mb-3"></select>

        <div class="overflow-x-auto">
            <table class="w-full min-w-[400px] table-auto">
                <thead>
                    <tr class="border-b bg-gray-200">
                        <th class="p-2">Mes</th>
                        <th class="p-2">Estado</th>
                        <th class="p-2">Método</th>
                        <th class="p-2">Fecha</th>
                        <th class="p-2">Obs.</th>
                    </tr>
                </thead>
                <tbody id="tbodyHistorial"></tbody>
            </table>
        </div>

        <div class="flex justify-end mt-4">
            <button onclick="cerrarModalHistorial()" class="btn bg-gray-300">Cerrar</button>
        </div>

    </div>
</div>


<!-- =============================
     SCRIPTS
============================== -->
<script src="../js/config.js"></script>
<script src="/js/pagos.js" defer></script>

</body>
</html>
